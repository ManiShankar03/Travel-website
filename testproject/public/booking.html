<!Doctype html>
<html class="no-js"  lang="en">

	<head>
		<!-- META DATA -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

		<!--font-family-->
		<link href="https://fonts.googleapis.com/css?family=Rufina:400,700" rel="stylesheet" />

		<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet" />

		<!-- TITLE OF SITE -->
		<title>India to France</title>

		<!-- favicon img -->
		<link rel="shortcut icon" type="image/icon" href="assets/logo/favicon.png"/>

		<!--font-awesome.min.css-->
		<link rel="stylesheet" href="assets/css/font-awesome.min.css" />

		<!--animate.css-->
		<link rel="stylesheet" href="assets/css/animate.css" />
		<link rel="stylesheet" href="assets/css/cancelbutton.css">

		<!--hover.css-->
		<link rel="stylesheet" href="assets/css/hover-min.css">

		<!--datepicker.css-->
		<link rel="stylesheet"  href="assets/css/datepicker.css" >

		<!--owl.carousel.css-->
        <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
		<link rel="stylesheet" href="assets/css/owl.theme.default.min.css"/>

		<!-- range css-->
        <link rel="stylesheet" href="assets/css/jquery-ui.min.css" />

		<!--bootstrap.min.css-->
		<link rel="stylesheet" href="assets/css/bootstrap.min.css" />

		<!-- bootsnav -->
		<link rel="stylesheet" href="assets/css/bootsnav.css"/>
		<link rel='stylesheet' href="assets/css/usermenu.css">

		<!--style.css-->
		

		<!--responsive.css-->
		<link rel="stylesheet" href="assets/css/responsive.css" />
		<link rel="stylesheet" href="assets/css/button.css">
		<link rel="stylesheet" type="text/css" href="assets/css/country.css">
		<link rel="stylesheet" href="assets/css/price.css">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		<style>/* CSS */
.section-padding {
    padding-top: 100px; 
    padding-bottom: 50px; 
}

    #details {
    background-image:url("booking.png");
        background-color: #f9f9f9; /* Light background for the section */
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* subtle shadow for depth */
        padding: 20px;
        margin-top: 30px;
       
    }

    #details .container {
        max-width: 600px; /* Adjust as needed */
        margin: auto; /* Centers the form in the section */
    }

    #details h2 {
        text-align: center;
        color: #333;
        margin-bottom: 30px; /* Adds space below the heading */
    }

    #details .form-group {
        margin-bottom: 20px;
    }

    #details .form-control {
        border-radius: 5px;
        height: 45px; /* Larger form fields */
        border: 1px solid #ddd;
    }

    #details .form-control:focus {
        border-color: #007bff;
        box-shadow: inset 0 1px 1px rgba(0, 123, 255, 0.075), 0 0 8px rgba(0, 123, 255, 0.6);
    }

    #details .btn-primary {
        width: 100%;
        padding: 10px;
        border-radius: 5px;
        font-size: 18px; /* Larger font size for the button */
    }
</style>

     
		
	</head>
	
	<body>
		<!--[if lte IE 9]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade
			your browser</a> to improve your experience and security.</p>
		<![endif]-->

		<!-- main-menu Start -->
		<header class="top-area">
			<div class="header-area">
				<div class="container">
					<div class="row">
						<div class="col-sm-2">
							<div class="logo">
								<a href="index.html">
									Travel<span>Scape</span>
								</a>
							</div><!-- /.logo-->
						</div><!-- /.col-->
						<div class="col-sm-10">
							<div class="main-menu">
							
								<!-- Brand and toggle get grouped for better mobile display -->
								<div class="navbar-header">
									<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
										<i class="fa fa-bars"></i>
									</button><!-- / button-->
								</div><!-- /.navbar-header-->
								<div class="collapse navbar-collapse">		  
									<ul class="nav navbar-nav navbar-right">
										<li class="smooth-menu"><a href="#details">Travel Details</a></li>
										
										
										<li>
										                                              <button class="book-btn" id="userMenuButton">Welcome ${req.session.username}</button>
<div id="userMenu" class="user-menu" style="display: none;">
    <ul>
        <li id="dashboard">Dashboard</li>
        <li id="logout">Logout</li>
    </ul>
</div>
</li>
</ul>
										
										
									
								</div><!-- /.navbar-collapse -->
							</div><!-- /.main-menu-->
						</div><!-- /.col-->
					
					<div class="home-border"></div><!-- /.home-border-->
				</div><!-- /.container-->
			</div><!-- /.header-area -->

		</header><!-- /.top-area-->
		<body>
		<!-- Form Section Start -->
<section id="details" class="section-padding">
    <div class="container" style="width:50%;margin-top:120px;">
        <h2>Please fill the travel details</h2>
        <form id="travelSelectionForm">
            <div class="form-group">
                <label for="departureSelect">From</label>
                <select id="departureSelect" class="form-control" onchange="fetchDestinations()" required>
                    <option value="">Select a country</option>
                    <!-- Countries will be loaded here -->
                </select>
            </div>
            <div class="form-group">
                <label for="arrivalSelect">To</label>
                <select id="arrivalSelect" class="form-control" required>
                    <option value="">Select a country</option>
                    <!-- Destinations will be loaded here -->
                </select>
            </div>
           <div class="form-group">
    <label for="dateRangeSelect">Select Travel Dates</label>
    <select id="dateRangeSelect" class="form-control" required>
        <option value="">Select a date range</option>
    </select>
</div>
            <div class="form-group">
                <label for="hotelSelect">Select Hotel Type</label>
                <select id="hotelSelect" class="form-control" required>
                    <option value="">Select a hotel type</option>
                    <!-- Hotel types will be loaded here -->
                </select>
                
            </div>
            <div class="form-group">
                <label for="flightSelect">Select Flight Type</label>
                <select id="flightSelect" class="form-control" required>
                    <option value="">Select a flight type</option>
                    <!-- Flight types will be loaded here -->
                </select>
            </div>
            <div class="form-group">
    <label for="fileUpload">Upload Visa document</label>
    <input type="file" id="fileUpload" name="fileUpload" class="form-control" required>
</div>


            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
    
</section>
<!-- Form Section End -->

</body>	
<footer class="footer-copyright">
<div class="container">
<div class="footer-content">
<div class="row">

<div class="col-sm-3">
<div class="single-footer-item">
<div class="footer-logo">
<a href="index.html">
travel<span>Scape</span>
</a>
<p>
best travel agency
</p>
</div>
</div><!--/.single-footer-item-->
</div><!--/.col-->


<div class="col-sm-3">
<div class="single-footer-item">
<h2>popular destination</h2>
<div class="single-footer-txt">
<p><a href="#">china</a></p>
<p><a href="#">france</a></p>
<p><a href="#">brazil</a></p>
<p><a href="#">united kingdom</a></p>
<p><a href="#">india</a></p>
</div><!--/.single-footer-txt-->
</div><!--/.single-footer-item-->
</div><!--/.col-->

<div class="col-sm-3">
<div class="single-footer-item text-center">
<h2 class="text-left">contacts</h2>
<div class="single-footer-txt text-left">
<p>+91 9734812785</p>
<p class="foot-email"><a href="#">info@travelscape.com</a></p>
<p>Dairy Circle 336/A</p>
<p>Bengaluru, Karnataka, India</p>
</div><!--/.single-footer-txt-->
</div><!--/.single-footer-item-->
</div><!--/.col-->

</div><!--/.row-->

</div><!--/.footer-content-->
<hr>
<div class="foot-icons ">
<ul class="footer-social-links list-inline list-unstyled">
<li><a href="#" target="_blank" class="foot-icon-bg-1"><i class="fa fa-facebook"></i></a></li>
<li><a href="#" target="_blank" class="foot-icon-bg-2"><i class="fa fa-twitter"></i></a></li>
<li><a href="#" target="_blank" class="foot-icon-bg-3"><i class="fa fa-instagram"></i></a></li>
</ul>
<p>&copy; 2024 <a href="#">TravelScape</a>. All Right Reserved</p>

</div><!--/.foot-icons-->
<div id="scroll-Top">
<i class="fa fa-angle-double-up return-to-top" id="scroll-top" data-toggle="tooltip" data-placement="top" title="" data-original-title="Back to Top" aria-hidden="true"></i>
</div><!--/.scroll-Top-->
</div><!-- /.container-->

</footer><!-- /.footer-copyright-->
<!-- footer-copyright end -->




		<script src="assets/js/jquery.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->

		<!--modernizr.min.js-->
		<script  src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>


		<!--bootstrap.min.js-->
		<script  src="assets/js/bootstrap.min.js"></script>

		<!-- bootsnav js -->
		<script src="assets/js/bootsnav.js"></script>

		<!-- jquery.filterizr.min.js -->
		<script src="assets/js/jquery.filterizr.min.js"></script>

		<script  src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>

		<!--jquery-ui.min.js-->
        <script src="assets/js/jquery-ui.min.js"></script>

        <!-- counter js -->
		<script src="assets/js/jquery.counterup.min.js"></script>
		<script src="assets/js/waypoints.min.js"></script>

		<!--owl.carousel.js-->
        <script  src="assets/js/owl.carousel.min.js"></script>

        <!-- jquery.sticky.js -->
		<script src="assets/js/jquery.sticky.js"></script>

        <!--datepicker.js-->
        <script  src="assets/js/datepicker.js"></script>

		<!--Custom JS-->
		<script src="assets/js/custom.js"></script>
		<script src="assets/js/searchdestinations.js"></script>
		<script src="assets/js/cancelbutton.js"></script>
		<script src="assets/js/usermenu.js"></script>
		
		
    

		<script>
      document.addEventListener('DOMContentLoaded', function() {
    var userMenuButton = document.getElementById('userMenuButton');
    fetchCountries();
    populateDateRanges();
    

    fetch('/get-username')
        .then(response => response.json())
        .then(data => {
            if (data.username) {
                var username = data.username;
                userMenuButton.textContent = 'Welcome ' + username;

                // Get the computed style of the button
                var buttonStyle = window.getComputedStyle(userMenuButton);

                // Calculate width based on content and existing padding
                userMenuButton.style.width = 'auto'; // First set to auto to get natural size
                var contentWidth = userMenuButton.offsetWidth; // Natural size
                var totalPadding = parseFloat(buttonStyle.paddingLeft) + parseFloat(buttonStyle.paddingRight);

                userMenuButton.style.width = (contentWidth + totalPadding) + 'px';
            }
        })
        .catch(error => console.error('Error:', error));
});

function fetchCountries() {
    fetch('/api/countries')
        .then(response => response.json())
        .then(data => populateCountries(data))
        .catch(error => console.error('Error fetching countries:', error));
}

function populateCountries(countries) {
    const selectElement = document.getElementById('departureSelect');
    countries.forEach(country => {
        let option = document.createElement('option');
        option.value = country.country_name;
        option.textContent = country.country_name;
        selectElement.appendChild(option);
    });
}

function fetchDestinations() {
    const selectedCountry = document.getElementById('departureSelect').value;
    fetch('/api/destinations/' + selectedCountry)
        .then(response => response.json())
        .then(data => populateDestinations(data))
        .catch(error => console.error('Error fetching destinations:', error));
}

function populateDestinations(destinations) {
    const selectElement = document.getElementById('arrivalSelect');
    selectElement.innerHTML = ''; // Clear previous options

    // Add a default disabled option
    let defaultOption = document.createElement('option');
    defaultOption.value = '';
    defaultOption.textContent = 'Select a country';
    defaultOption.disabled = true;
    defaultOption.selected = true;
    selectElement.appendChild(defaultOption);

    // Populate the select element with destinations
    destinations.forEach(destination => {
        let option = document.createElement('option');
        option.value = destination.Arrival_country_name;
        option.textContent = destination.Arrival_country_name;
        selectElement.appendChild(option);
    });
}

document.getElementById('arrivalSelect').addEventListener('change', function() {
    fetchHotelTypes();
    fetchFlightTypes();
});

function fetchHotelTypes() {
    const departureCountry = document.getElementById('departureSelect').value;
    const arrivalCountry = document.getElementById('arrivalSelect').value;
    if (departureCountry && arrivalCountry) {
        fetch(`/api/hotels/${departureCountry}/${arrivalCountry}`)
            .then(response => response.json())
            .then(data => populateHotelTypes(data))
            .catch(error => console.error('Error fetching hotel types:', error));
    }
}

function populateHotelTypes(hotelTypes) {
    const selectElement = document.getElementById('hotelSelect');
    selectElement.innerHTML = ''; // Clear previous options
    hotelTypes.forEach(type => {
        let option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        selectElement.appendChild(option);
    });
}

function fetchFlightTypes() {
    const departureCountry = document.getElementById('departureSelect').value;
    const arrivalCountry = document.getElementById('arrivalSelect').value;
    if (departureCountry && arrivalCountry) {
        fetch(`/api/flights/${departureCountry}/${arrivalCountry}`)
            .then(response => response.json())
            .then(data => populateFlightTypes(data))
            .catch(error => console.error('Error fetching flight types:', error));
    }
}

function populateFlightTypes(flightTypes) {
    const selectElement = document.getElementById('flightSelect');
    selectElement.innerHTML = ''; // Clear previous options
    flightTypes.forEach(type => {
        let option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        selectElement.appendChild(option);
    });
}


document.getElementById('travelSelectionForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission

    var departureCountry = document.getElementById('departureSelect').value;
    var arrivalCountry = document.getElementById('arrivalSelect').value;
    var dateRangeSelect=document.getElementById('dateRangeSelect').value;

    // Fetch the destination ID based on departure and arrival countries
    fetch(`/api/getDestinationId/${departureCountry}/${arrivalCountry}`)
        .then(response => response.json())
        .then(destinationData => {
            if (!destinationData.destination_id) {
                throw new Error('Destination ID not found');
            }
            return destinationData.destination_id;
        })
        .then(destinationId => {
            var hotelType = document.getElementById('hotelSelect').value;
            var flightType = document.getElementById('flightSelect').value;
            

            return Promise.all([
                fetch(`/api/hotelPrice/${hotelType}/${destinationId}`).then(response => response.json()),
                fetch(`/api/flightPrice/${flightType}/${destinationId}`).then(response => response.json()),
                fetch(`/api/activityPrice/${destinationId}`).then(response => response.json()),
                fetch(`/api/otherexpensePrice/${destinationId}`).then(response => response.json())
                
            ]);
        })
        .then(prices => {
            var hotelPrice = prices[0].price;
            var flightPrice = prices[1].price;
            var activityPrice=prices[2].price;
            var otherexpensePrice=prices[3].price;
            var totalPrice = hotelPrice + flightPrice+activityPrice+otherexpensePrice;
            
            sessionStorage.setItem('totalPrice', totalPrice);
             sessionStorage.setItem('hotelPrice', hotelPrice);
      sessionStorage.setItem('flightPrice',flightPrice);
      sessionStorage.setItem('activityPrice',activityPrice);
      sessionStorage.setItem('otherexpensePrice', otherexpensePrice);
       sessionStorage.setItem('departureCountry', departureCountry);
       sessionStorage.setItem('arrivalCountry', arrivalCountry);
      sessionStorage.setItem('dateRangeSelect',dateRangeSelect);
       
            
            window.location.href = `/bill?hotelPrice=${hotelPrice}&flightPrice=${flightPrice}&activityPrice=${activityPrice}&otherexpensePrice=${otherexpensePrice}&totalPrice=${totalPrice}`;

        })
        .catch(error => {
            console.error('Error:', error);
        });
});
function populateDateRanges() {
    var today = new Date();
    today.setHours(0, 0, 0, 0); // Set time to 00:00:00 for accurate date comparison
    var dateRangeSelect = document.getElementById('dateRangeSelect');
    
    for (var i = 0; i < 3; i++) {
        var year = today.getFullYear();
        var month = today.getMonth() + i;

        // Adjust year and month for overflow
        if (month > 11) {
            month -= 12;
            year += 1;
        }

        var monthFormatted = ('0' + (month + 1)).slice(-2);

        // Check if the first date range is in the past
        if (new Date(year, month, 1) >= today) {
            addDateRangeOption(dateRangeSelect, year, monthFormatted, 1, 5);
        }

        // Check if the second date range is in the past
        if (new Date(year, month, 15) >= today) {
            addDateRangeOption(dateRangeSelect, year, monthFormatted, 15, 20);
        }
    }
}

function addDateRangeOption(selectElement, year, month, startDay, endDay) {
    var optionText = `${year}-${month}-${startDay.toString().padStart(2, '0')} to ${year}-${month}-${endDay.toString().padStart(2, '0')}`;
    var option = new Option(optionText, optionText);
    selectElement.add(option);
}

    </script>
   

		

</body>
</html>

